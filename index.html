<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moon Phase Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes moonGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
      50% { box-shadow: 0 0 40px rgba(255, 255, 255, 0.6); }
    }

    @keyframes shootingStar {
      0% {
        transform: translateX(-100px) translateY(-100px);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateX(300px) translateY(300px);
        opacity: 0;
      }
    }

    .star {
      position: absolute;
      background-color: white;
      border-radius: 50%;
      pointer-events: none;
      animation: twinkle 2s infinite;
    }

    .shooting-star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: linear-gradient(45deg, white, transparent);
      border-radius: 50%;
      animation: shootingStar 3s linear infinite;
    }

    .moon-phase {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      position: relative;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      margin: auto;
      animation: float 4s ease-in-out infinite, moonGlow 3s ease-in-out infinite;
      box-shadow: 0 0 40px rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .moon-phase:hover {
      transform: scale(1.1);
    }

    .moon-phase::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(135deg, #2c2c2c, #1a1a1a);
      transition: all 0.5s ease;
    }

    .moon-small {
      width: 70px;
      height: 70px;
      animation: float 3s ease-in-out infinite;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }

    .moon-small:hover {
      transform: scale(1.05);
    }

    /* Moon phases */
    .new-moon::before { clip-path: circle(50%); }
    .waxing-crescent::before { clip-path: ellipse(30% 50% at 70% 50%); }
    .first-quarter::before { clip-path: ellipse(50% 50% at 100% 50%); }
    .waxing-gibbous::before { clip-path: ellipse(70% 50% at 100% 50%); }
    .full-moon::before { clip-path: circle(0%); }
    .waning-gibbous::before { clip-path: ellipse(70% 50% at 0% 50%); }
    .last-quarter::before { clip-path: ellipse(50% 50% at 0% 50%); }
    .waning-crescent::before { clip-path: ellipse(30% 50% at 30% 50%); }

    .phase-card {
      transition: all 0.3s ease;
    }

    .phase-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
</head>
<body class="bg-gradient-to-b from-indigo-950 via-purple-900 to-gray-900 min-h-screen text-white font-sans relative overflow-x-hidden">
  <div id="stars-container" class="fixed inset-0 overflow-hidden -z-10"></div>

  <div class="container mx-auto px-4 py-8">
    <header class="text-center mb-12">
      <h1 class="text-5xl md:text-7xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-300 via-yellow-400 to-yellow-500 mb-6 drop-shadow-lg">
        üåô Moon Phase Tracker
      </h1>
      <p class="text-xl text-indigo-200 max-w-2xl mx-auto">
        Discover today's moon phase and explore the celestial dance of our lunar companion
      </p>
    </header>

    <!-- Current Phase -->
    <section class="bg-gradient-to-br from-indigo-900/50 to-purple-900/50 rounded-3xl p-10 shadow-2xl border border-indigo-600/40 mb-12 backdrop-blur-lg">
      <h2 class="text-4xl font-semibold mb-10 text-center text-yellow-300">Today's Moon Phase</h2>
      <div class="flex flex-col lg:flex-row items-center justify-center gap-16">
        <div id="today-moon" class="moon-phase" title="Click to see moon details"></div>
        <div class="text-center lg:text-left">
          <p id="today-phase" class="text-4xl font-bold mb-6 text-yellow-200">Loading...</p>
          <p id="today-date" class="text-2xl mb-4 text-indigo-200"></p>
          <p id="today-illumination" class="text-xl text-purple-200 mb-2"></p>
          <p id="today-age" class="text-xl text-purple-200 mb-4"></p>
          <p id="next-phase" class="text-lg text-indigo-300 italic mb-3"></p>
          <div class="text-sm text-indigo-300 space-y-1">
            <p id="moon-sign">üåô Moon in Zodiac: Loading...</p>
            <p>üìç Coordinates: 40.7¬∞N, 74.0¬∞W (NYC)</p>
            <p>üî¨ Algorithm: J2000 Epoch + Cosine Illumination</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Moon Facts -->
    <section class="bg-gradient-to-br from-purple-900/40 to-indigo-900/40 rounded-3xl p-8 shadow-xl border border-purple-600/40 mb-12 backdrop-blur-sm">
      <h3 class="text-3xl font-semibold mb-6 text-center text-purple-300">‚ú® Lunar Wisdom</h3>
      <p id="moon-fact" class="text-center text-indigo-200 text-xl italic leading-relaxed"></p>
      <button id="new-fact" class="mt-6 mx-auto block bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-full transition-colors">
        New Fact ‚ú®
      </button>
    </section>

    <!-- Forecast Toggle -->
    <div class="text-center mb-10">
      <button id="forecast-toggle" class="bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 px-10 py-4 rounded-full shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105 text-xl font-semibold">
        Show Next 7 Days üåô
      </button>
    </div>

    <!-- Forecast -->
    <section id="forecast" class="hidden bg-gradient-to-br from-indigo-900/30 to-purple-900/30 rounded-3xl p-8 shadow-xl border border-indigo-600/30 backdrop-blur-sm">
      <h2 class="text-3xl font-semibold mb-8 text-center text-indigo-300">7-Day Lunar Forecast</h2>
      <div id="forecast-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-6"></div>
    </section>

    <!-- Footer -->
    <footer class="text-center mt-16 text-indigo-300">
      <p class="text-lg">Made with ‚ù§Ô∏è for moon lovers everywhere</p>
      <p class="text-sm mt-2 opacity-75">Data calculated using astronomical algorithms</p>
    </footer>
  </div>

  <script>
    // --- Background Stars and Shooting Stars ---
    function createStars() {
      const container = document.getElementById("stars-container");
      if (!container) return;
      
      // Regular stars
      for (let i = 0; i < 120; i++) {
        const star = document.createElement("div");
        const size = Math.random() * 3 + 1;
        star.className = "star";
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.animationDelay = `${Math.random() * 4}s`;
        star.style.animationDuration = `${Math.random() * 3 + 2}s`;
        container.appendChild(star);
      }

      // Create shooting stars periodically
      setInterval(() => {
        if (Math.random() < 0.3) {
          const shootingStar = document.createElement("div");
          shootingStar.className = "shooting-star";
          shootingStar.style.left = `${Math.random() * 100}%`;
          shootingStar.style.top = `${Math.random() * 50}%`;
          container.appendChild(shootingStar);
          
          setTimeout(() => {
            if (shootingStar.parentNode) {
              shootingStar.parentNode.removeChild(shootingStar);
            }
          }, 3000);
        }
      }, 5000);
    }

    // --- Moon Phase Data ---
    const phaseNames = [
      "New Moon", "Waxing Crescent", "First Quarter", "Waxing Gibbous",
      "Full Moon", "Waning Gibbous", "Last Quarter", "Waning Crescent"
    ];

    const phaseClasses = [
      "new-moon", "waxing-crescent", "first-quarter", "waxing-gibbous",
      "full-moon", "waning-gibbous", "last-quarter", "waning-crescent"
    ];

    const phaseEmojis = ["üåë", "üåí", "üåì", "üåî", "üåï", "üåñ", "üåó", "üåò"];

    const moonFacts = [
      "The Moon is moving away from Earth at about 3.8 cm per year, gradually making solar eclipses impossible.",
      "A lunar day (from sunrise to sunrise on the Moon) lasts about 29.5 Earth days.",
      "The Moon's gravity is about 16.5% of Earth's gravity (1/6th).",
      "The same side of the Moon always faces Earth due to tidal locking - a phenomenon called synchronous rotation.",
      "The Moon was likely formed 4.5 billion years ago from debris after a Mars-sized object called Theia hit Earth.",
      "The Moon influences ocean tides on Earth through its gravitational pull, creating high and low tides.",
      "The Moon has water ice at its polar regions, discovered by NASA's lunar missions.",
      "A lunar eclipse occurs when Earth casts a shadow on the Moon, turning it red due to atmospheric refraction.",
      "Moon phases are caused by the changing angles of sunlight as the Moon orbits Earth.",
      "The Moon has no atmosphere, so there's no weather, no sound, and meteors hit the surface directly.",
      "Surface temperatures on the Moon range from -233¬∞C (-387¬∞F) at night to 123¬∞C (253¬∞F) in sunlight.",
      "There are over 200 known moons in our solar system, but ours is the 5th largest.",
      "The Moon stabilizes Earth's axial tilt, preventing extreme climate changes over geological time.",
      "Lunar dust (regolith) is extremely fine and abrasive, posing challenges for space equipment.",
      "The Moon's orbit is elliptical, so its distance from Earth varies between 356,500 and 406,700 km.",
      "During a supermoon, the Moon appears about 14% larger and 30% brighter than a typical full moon.",
      "The Moon's gravitational influence slows Earth's rotation, gradually lengthening our days.",
      "Mare (lunar seas) are actually ancient lava plains formed by volcanic activity billions of years ago.",
      "The Moon has moonquakes caused by tidal forces and thermal expansion as it heats and cools.",
      "Only 12 humans have ever walked on the Moon, all during NASA's Apollo missions (1969-1972)."
    ];

    // Astronomical constants for precise lunar calculations
    const LUNAR_MONTH = 29.53058868; // Synodic month in days
    const LUNAR_CYCLE_EPOCHS = {
      // Known new moon epochs for verification
      J2000: { date: new Date('2000-01-06 18:14:00 UTC'), age: 0 },
      RECENT: { date: new Date('2024-01-11 11:57:00 UTC'), age: 0 }
    };

    function getMoonPhase(date) {
      // Use J2000 epoch for astronomical accuracy
      const epoch = LUNAR_CYCLE_EPOCHS.J2000;
      const daysSinceEpoch = (date.getTime() - epoch.date.getTime()) / (1000 * 60 * 60 * 24);
      
      // Calculate lunar age (days since new moon)
      let lunarAge = (daysSinceEpoch % LUNAR_MONTH + LUNAR_MONTH) % LUNAR_MONTH;
      
      // Adjust for small numerical errors
      if (lunarAge < 0) lunarAge += LUNAR_MONTH;
      if (lunarAge >= LUNAR_MONTH) lunarAge -= LUNAR_MONTH;
      
      // Calculate phase index (0-7) with more precision
      const phasePosition = lunarAge / LUNAR_MONTH;
      let phaseIndex = Math.floor(phasePosition * 8);
      
      // Ensure phase index is within bounds
      if (phaseIndex >= 8) phaseIndex = 0;
      if (phaseIndex < 0) phaseIndex = 7;
      
      // Calculate precise illumination percentage
      const illumination = getAccurateIllumination(lunarAge);
      
      return { 
        phaseIndex, 
        lunarAge: lunarAge,
        illumination: illumination,
        phasePosition: phasePosition
      };
    }

    function getAccurateIllumination(lunarAge) {
      // More accurate illumination calculation using cosine function
      const phase = (lunarAge / LUNAR_MONTH) * 2 * Math.PI;
      
      // Illumination follows a cosine curve
      // 0% at new moon (0¬∞), 100% at full moon (180¬∞)
      const illuminationFraction = (1 - Math.cos(phase)) / 2;
      
      return illuminationFraction * 100;
    }

    function getMoonRiseSet(date, latitude = 40.7128, longitude = -74.0060) {
      // Simplified moon rise/set calculation for demonstration
      // Note: Full implementation would require complex astronomical algorithms
      const lunarAge = getMoonPhase(date).lunarAge;
      
      // Approximate moon rise/set based on lunar age
      const baseRise = 6 + (lunarAge / LUNAR_MONTH) * 24; // Hours
      const baseSet = baseRise + 12; // Approximately 12 hours visibility
      
      return {
        rise: (baseRise % 24).toFixed(1),
        set: (baseSet % 24).toFixed(1)
      };
    }

    function getNextPhase(currentPhaseIndex, lunarAge) {
      // Calculate exact days to each major phase
      const phases = [
        { name: "New Moon", position: 0 },
        { name: "First Quarter", position: 0.25 },
        { name: "Full Moon", position: 0.5 },
        { name: "Last Quarter", position: 0.75 }
      ];
      
      const currentPosition = lunarAge / LUNAR_MONTH;
      let nextPhase = null;
      let shortestDistance = Infinity;
      
      phases.forEach(phase => {
        let distance = phase.position - currentPosition;
        if (distance <= 0) distance += 1; // Next cycle
        
        if (distance < shortestDistance) {
          shortestDistance = distance;
          nextPhase = phase;
        }
      });
      
      const daysToNext = shortestDistance * LUNAR_MONTH;
      
      return {
        name: nextPhase.name,
        days: Math.ceil(daysToNext)
      };
    }

    function getMoonSign(date) {
      // Simplified zodiac sign calculation (approximate)
      const lunarAge = getMoonPhase(date).lunarAge;
      const signs = ["‚ôà Aries", "‚ôâ Taurus", "‚ôä Gemini", "‚ôã Cancer", 
                    "‚ôå Leo", "‚ôç Virgo", "‚ôé Libra", "‚ôè Scorpio", 
                    "‚ôê Sagittarius", "‚ôë Capricorn", "‚ôí Aquarius", "‚ôì Pisces"];
      
      // Moon moves through zodiac roughly every 2.5 days
      const signIndex = Math.floor((lunarAge * 12 / LUNAR_MONTH)) % 12;
      return signs[signIndex];
    }

    function updateToday() {
      try {
        const today = new Date();
        const moonData = getMoonPhase(today);
        const phaseName = phaseNames[moonData.phaseIndex];
        const phaseClass = phaseClasses[moonData.phaseIndex];
        const nextPhase = getNextPhase(moonData.phaseIndex, moonData.lunarAge);
        const moonSign = getMoonSign(today);
        const moonTimes = getMoonRiseSet(today);

        // Update moon visual
        const moonEl = document.getElementById("today-moon");
        if (moonEl) {
          moonEl.className = `moon-phase ${phaseClass}`;
        }

        // Update text elements with enhanced astronomical data
        const elements = {
          'today-phase': `${phaseEmojis[moonData.phaseIndex]} ${phaseName}`,
          'today-date': today.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          }),
          'today-illumination': `Illumination: ${moonData.illumination.toFixed(1)}%`,
          'today-age': `Lunar Age: ${moonData.lunarAge.toFixed(1)} days`,
          'next-phase': `Next ${nextPhase.name} in ${nextPhase.days} day${nextPhase.days !== 1 ? 's' : ''}`
        };

        // Add moon sign if element exists
        const moonSignEl = document.getElementById('moon-sign');
        if (moonSignEl) {
          moonSignEl.textContent = `Moon in ${moonSign}`;
        }

        // Add moon times if elements exist
        const moonRiseEl = document.getElementById('moon-rise');
        const moonSetEl = document.getElementById('moon-set');
        if (moonRiseEl) moonRiseEl.textContent = `Rise: ${moonTimes.rise}:00`;
        if (moonSetEl) moonSetEl.textContent = `Set: ${moonTimes.set}:00`;

        Object.keys(elements).forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = elements[id];
          }
        });

        // Log current lunar data for verification
        console.log(`üåô Lunar Data for ${today.toDateString()}:`);
        console.log(`Phase: ${phaseName} (${moonData.phaseIndex})`);
        console.log(`Age: ${moonData.lunarAge.toFixed(2)} days`);
        console.log(`Illumination: ${moonData.illumination.toFixed(1)}%`);
        console.log(`Next Phase: ${nextPhase.name} in ${nextPhase.days} days`);

      } catch (error) {
        console.error('Error updating moon phase:', error);
      }
    }

    function generateForecast() {
      try {
        const grid = document.getElementById("forecast-grid");
        if (!grid) return;
        
        grid.innerHTML = "";

        const today = new Date();
        for (let i = 1; i <= 7; i++) {
          const date = new Date(today);
          date.setDate(today.getDate() + i);
          const moonData = getMoonPhase(date);

          const card = document.createElement("div");
          card.className = "phase-card bg-indigo-800/40 rounded-2xl p-4 text-center shadow-lg hover:bg-indigo-700/50 transition-all duration-300 border border-indigo-600/30";
          
          // Create more detailed forecast cards
          card.innerHTML = `
            <p class="text-sm text-indigo-300 mb-3 font-medium">${date.toLocaleDateString('en-US', { 
              weekday: 'short',
              month: 'short', 
              day: 'numeric' 
            })}</p>
            <div class="moon-phase moon-small ${phaseClasses[moonData.phaseIndex]} mb-3 mx-auto" title="${phaseNames[moonData.phaseIndex]}"></div>
            <p class="font-semibold text-yellow-200 text-sm mb-1">${phaseNames[moonData.phaseIndex]}</p>
            <p class="text-xs text-purple-300 mb-1">${moonData.illumination.toFixed(0)}% lit</p>
            <p class="text-xs text-indigo-300">Age: ${moonData.lunarAge.toFixed(1)}d</p>
          `;
          
          grid.appendChild(card);
        }
      } catch (error) {
        console.error('Error generating forecast:', error);
      }
    }

    function showRandomFact() {
      try {
        const factElement = document.getElementById("moon-fact");
        if (factElement) {
          const randomFact = moonFacts[Math.floor(Math.random() * moonFacts.length)];
          factElement.textContent = randomFact;
          factElement.classList.add('pulse');
          setTimeout(() => factElement.classList.remove('pulse'), 1000);
        }
      } catch (error) {
        console.error('Error showing moon fact:', error);
      }
    }

    // Event Listeners and Initialization
    document.addEventListener('DOMContentLoaded', function() {
      try {
        // Forecast toggle functionality
        const forecastToggle = document.getElementById("forecast-toggle");
        if (forecastToggle) {
          forecastToggle.addEventListener("click", () => {
            const forecast = document.getElementById("forecast");
            
            if (forecast && forecast.classList.contains("hidden")) {
              forecast.classList.remove("hidden");
              generateForecast();
              forecastToggle.textContent = "Hide Forecast üåô";
              // Smooth scroll to forecast
              forecast.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else if (forecast) {
              forecast.classList.add("hidden");
              forecastToggle.textContent = "Show Next 7 Days üåô";
            }
          });
        }

        // New fact button functionality
        const newFactBtn = document.getElementById("new-fact");
        if (newFactBtn) {
          newFactBtn.addEventListener("click", showRandomFact);
        }

        // Moon click functionality
        const todayMoon = document.getElementById("today-moon");
        if (todayMoon) {
          todayMoon.addEventListener("click", () => {
            updateToday();
            todayMoon.style.transform = "scale(1.2)";
            setTimeout(() => {
              todayMoon.style.transform = "";
            }, 300);
          });
        }

        // Initialize the app
        createStars();
        updateToday();
        showRandomFact();

        // Update every hour
        setInterval(updateToday, 3600000);

      } catch (error) {
        console.error('Error during initialization:', error);
      }
    });
  </script>
</body>
</html>
